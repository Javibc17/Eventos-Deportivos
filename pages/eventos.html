<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Eventos</title>
	<link rel="stylesheet" href="../styles/crudStyle.css">
</head>
<body>
	<header>
		<h1>Eventos</h1>
	</header>

	<main>
		<div>
			<table>
				<thead>
					<th>Id</th>
					<th>Nombre Evento</th>
					<th>Tipo Deporte</th>
					<th>Fecha</th>
					<th>Hora</th>
					<th>Ubicacion</th>
					<th>Organizador</th>
				</thead>

				<tbody>
					
				</tbody>
			</table>
		</div>

		<form method="post" action="../procesar.php?table=eventos">
			<div>
				<input type="text" name="nombre_evento" id="nombre_evento" placeholder="Nombre del Evento" required>
				<input type="text" name="deporte" id="deporte" placeholder="Deporte" required>
				<div>
					<input type="datetime-local" name="fecha" id="fecha" required>

					<select name="idOrganizador" id="idOrganizador">
						<option selected disabled>Selecciona un Organizador</option>
					</select>
					
				</div>
				<input type="text" name="ubicacion" id="ubicacion" placeholder="Ubicacion" required>
				
			</div>
				
			<div>
				errores
			</div>
				
			<button type="submit">Crear</button>
		</form>
	</main>
	<script>
		async function fetchEvents() {
			try {
				const response = await fetch("http://localhost/carpeta/EventosDeportivosCrud/procesar.php?table=eventos")
				
				if (!response.ok) {
					throw new Error("Error en la solicitud")
				}

				const events = await response.json()
				
				if (events.length !== 0) {
					const tbody = document.querySelector("tbody")

					events.forEach(event => {
						const tr = document.createElement('tr')
						tr.innerHTML = `
							<td>${event.id}</td>
							<td>${event.nombre_evento}</td>
							<td>${event.tipo_deporte}</td>
							<td>${event.fecha}</td>
							<td>${event.hora}</td>
							<td>${event.ubicacion}</td>
							<td>
								<button onclick="editManager(${event.id})">Editar</button>
								<button onclick="deleteEvent(${event.id})">Eliminar</button>
							</td>
						`
						tbody.appendChild(tr)
					})
				}else{
					alert("No se ha encontrado ningun evento registrado")
				}
				
			} catch (error) {
				console.error("Hubo un problema con la solicitud:", error)
			}
		}
	
		fetchEvents()

		async function fetchOrganizadores() {
			try{
				const response = await fetch("http://localhost/carpeta/EventosDeportivosCrud/procesar.php?table=organizadores")
				
				if (!response.ok) {
					throw new Error("Error en la solicitud")
				}
				const managers = await response.json()
				
				console.log(managers)

				if (managers.length !== 0) {
					const select = document.querySelector("select")

					managers.forEach(manager => {
						const option = document.createElement('option')
						option.innerHTML = manager.nombre
						option.value = manager.id
						select.appendChild(option)
					})
					
				}else{
					alert("No se ha encontrado ningun evento registrado")
				}
				
			} catch (error) {
				console.error("Hubo un problema con la solicitud:", error)
			}
			
		}
			
		fetchOrganizadores()

	</script>
</body>
</html>